<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xmu.wowoto.payment.mapper.PaymentMapper">

    <insert id="addPayment" parameterType="payment" useGeneratedKeys="true" keyProperty="id">
        insert into payment(actual_price, is_successful, begin_time, end_time, order_id, gmt_create, gmt_modified, is_deleted,gmt_create,gmt_modified,end_time)
        values (#{actualPrice}, #{isSuccessful}, now(), date_add(now(), interval 30 minute), #{orderId}, date_sub(now(), interval 8 hour), date_sub(now(), interval 8 hour), #{beDeleted})
    </insert>

    <select id="findPayment" parameterType="Integer" resultType="payment">
        select *
        from payment
        where id = #{id} and is_deleted = 0
    </select>

    <select id="findPaymentBySn" parameterType="String" resultType="Integer">
        select id
        from payment where pay_sn = #{paySn} and is_deleted = 0
    </select>



    <update id="updatePayment" parameterType="Integer">
        update payment
        <trim prefix="set" suffixOverrides=",">
            <if test="true">gmt_modified=now(),</if>
            <if test="true">pay_time=now(),</if>
            <if test="true">end_time=now(),</if>
            <if test="true">is_successful=1,</if>
        </trim>
        WHERE id=#{id}
    </update>

    <update id="deletePayment" parameterType="Integer">
        update payment
        <trim prefix="set" suffixOverrides=",">
            <if test="true">gmt_modified=now(),</if>
            <if test="true">is_deleted=1,</if>
        </trim>
        WHERE id=#{id}
    </update>
</mapper>